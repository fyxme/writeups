from pwn import *
import string

# Flag: picoCTF{@g3nt6_1$_th3_c00l3$t_2432504}

def print_blocks(s):
    print " | ".join([s[i:i+32] for i in range(0, len(s),32)])

flag = "picoCTF{@g3nt6_1$_th3_c00l3$t_2432504}"

while(not flag or flag[-1] != "}"):
    c = connect("2018shell1.picoctf.com",37131)

    print c.recvrepeat(2)

    c.sendline('A'*(11+48-len(flag))) # send 13 chars

    resp = c.recvrepeat(2).strip()
    print_blocks(resp)

    to_decode = resp.decode('hex')
    to_decode = map(bytes, to_decode)

    c.close()

    offset = 12 + 31
    base_ac = 95

    garbage = 'A'*(12+48) + 'My agent identifying code is: '

    for ch in string.printable:
        print "sending:", ch
        c = connect("2018shell1.picoctf.com",37131)
        c.sendlineafter('report:', (garbage[len(flag):] + flag + ch))
        tmp = c.recvrepeat(2).strip()
        #print_blocks(tmp)
        tmp = tmp.decode('hex')
        tmp = map(bytes, tmp)
        if tmp[8*16:9*16] == to_decode[8*16:9*16]:
            flag += ch
            print "Found:", ch, " | Flag:", flag
            c.close()
            break

        c.close()
