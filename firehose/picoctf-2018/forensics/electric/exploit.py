from pwn import *
import base64

def sxor(s1,s2):
    return [ord(c1)^ord(c2) for c1,c2 in zip(s1,s2)]

c = connect("2018shell1.picoctf.com", 61333)

print c.recvrepeat(0.6)

c.sendline('i')
resp = c.recvrepeat(0.6)
print resp

flagtxt = resp[resp.find('flag'):].split("\n")[0]

print "flag.txt:", flagtxt

# encrypt file
c.sendline('n')
c.sendline('A'*29) # filename
c.sendline('AAAAA') # data - don't really care about this

print c.recvuntil("Share code:\n")
scode = c.recvline()

print "scode:", scode

print c.recvrepeat(0.6)

scode = base64.b64decode(scode)
int_state = sxor(scode, ('A'*29+'.txt'))

flat_scode = [i ^ ord(fg) for i, fg in zip(int_state, flagtxt)]
flat_scode = map(chr, flat_scode)
flat_scode = base64.b64encode("".join(flat_scode))

print flat_scode

c.sendline("e")
c.sendline(flat_scode)
print c.recvrepeat(0.8)

