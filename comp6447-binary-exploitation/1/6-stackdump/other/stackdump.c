#include <stdio.h>

void win() { // 0x80406cd
    system('/bin/sh');
}

int main(int argc, char const *argv[]) {
    // sub 144
    int canary;
    char question_buffer[48];

    canary = global_canary;

    setbuf(STDOUT, 0);
    puts("Lets try a real stack canary, like the ones GCC uses\n");
    printf("To make things easier, here's a useful stack pointer %p\n", sp);

    while(TRUE) {
        puts("a) input data\nb) dump memory\nc) print memory map\nd) quit\n");
        char * command_char = fgets(question_buffer, 48, STDIN);

        if(strcmp(command_char, '\n') == 0) continue;
        if(strcmp(command_char, 'd') == 0) break;

        if (strcmp(command_char, 'a') == 0) {
            char *buf;
            printf("len : ");
            gets(buf); // NOTE : Vulnerability
            int l_buf = atoi(buf);
            fread(buf, 1, l_buf, STDIN);
            puts('\n');

        } else if(strcmp(command_char, 'b') == 0) {
            printf("memory at %p: ", ); // esp + 40
            fwrite(in_buf - 4, 1, 22, STDOUT );
            puts("\n");

        } else if(strcmp(command_char, 'c') == 0) {
            system(sprintf(in_buf, "cat /proc/%u/maps", getpid()));

        } else {
            printf("Invalid option %c\n", command_char);
        }

    return 0;
}
